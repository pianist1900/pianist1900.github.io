<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="龚说龚有理">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="/img/home-notes-bg.jpeg">
    <meta property="twitter:image" content="/img/home-notes-bg.jpeg" />
    

    
    <meta name="title" content="python学习｜文件处理(pandas)" />
    <meta property="og:title" content="python学习｜文件处理(pandas)" />
    <meta property="twitter:title" content="python学习｜文件处理(pandas)" />
    

    
    <meta name="description" content="系统性讲解python的数据读取，为后续分析提供支撑">
    <meta property="og:description" content="系统性讲解python的数据读取，为后续分析提供支撑" />
    <meta property="twitter:description" content="系统性讲解python的数据读取，为后续分析提供支撑" />
    

    <meta property="og:url" content="https://pianist1900.github.io/post/2025-10-12-nt-pycs-file-handling2/" />

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="Will Gong, 龚元均, Will Gong Blog, 博客, 个人网站, 互联网, 大气化学, 数据分析">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>python学习｜文件处理(pandas) | Gong&#39;s Blog</title>

    <link rel="canonical" href="/post/2025-10-12-nt-pycs-file-handling2/">

    

    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hugo-theme-cleanwhite.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.min.css">

    
    <link rel="stylesheet" href="/css/font-awesome.all.min.css">

    
    <link rel="stylesheet" href="https://pianist1900.github.io/css/hidden-hero-title.css">

    
    <script src="/js/jquery.min.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    <script src="/js/lazysizes.min.js"></script>

    
    

</head>





<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">龚说龚有理</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">All Posts</a>
                    </li>
                    
                        
                    
                    
		    
                        <li><a href="/atmosphere//">ATMOSPHERE</a></li>
                    
                        <li><a href="/reading//">READING</a></li>
                    
                        <li><a href="/notes//">NOTES</a></li>
                    
                        <li><a href="/about//">ABOUT</a></li>
                    
		            <li>
                        <a href="/search"><i class="fa fa-search"></i></a>
		           </li>
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/home-notes-bg.jpeg')
    }
</style>

<header class="intro-header" >

    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                    </div>
                    <h1>python学习｜文件处理(pandas)</h1>
                    <h2 class="subheading">千里之行始于足下</h2>
                    <span class="meta">
                        
                            Posted by 
                            
                                Will Gong
                             
                            on 
                            Saturday, October 11, 2025
                            
                            
                            
                            
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <!-- > 千里之行始于足下 -->
<h3 id="pandas库处理数据">Pandas库处理数据</h3>
<p>本节续接着上节学习的open()函数，主要讲解pandas读取文件，熟悉文件操作与 pandas 读取方法都是必须的技能</p>
<ol>
<li>
<p><strong>利用pandas库读取文件</strong><br>
在<code>Python</code>中，<code>Pandas</code>是<code>Python</code>中最常用、最强大的数据分析库之一， 它的名字来源于 “Panel Data”（面板数据），最初用于经济学和统计学中的多维数据处理，如今已成为数据科学、机器学习，兴许环境科学中不可或缺的工具，它提供了极其方便的文件读写函数，常见文件读取格式包括CSV、Excel、JSON、TXT等。<br>
下面我们用实际例子进行对比讲解，数据内容如下表所示：</p>
<pre tabindex="0"><code>站点名称	        时间	    SO2	    NO2	    NOx	    O3	    CO	    PM10    PM2.5
站点A	2021-05-01 01:00	ssss	21	21	74	0.3	62	35
站点A	2021-05-01 02:00	2	18	19	75	0.282	49	34
站点A	2021-05-01 03:00	5	34	35	54	0.347	50	36
站点A	2021-05-01 04:00	11	46	46	35	0.578	72	43
站点A	2021-05-01 05:00	13	57	58	22	0.68	78	44
站点A	2021-05-01 06:00	25	53	55	24	0.764	80	50
站点A	2021-05-01 07:00	18	43	52	31	0.85	75	47
站点A	2021-05-01 08:00	17	35	47	44	0.983	89	48
站点A	2021-05-01 09:00	24	34	48	55	0.752	85	51
站点A	2021-05-01 10:00	18	22	29	78	0.538	89	43
站点A	2021-05-01 11:00	7	13	15	102	0.461	65	24
站点A	2021-05-01 12:00	6	11	13	114	0.389	62	18
站点A	2021-05-01 13:00	6	14	16	118	0.484	69	24
站点A	2021-05-01 14:00	7	13	14	128	0.309	88	32
站点A	2021-05-01 15:00	7	11	12	140	0.303	93	35
站点A	2021-05-01 16:00	7	12	12	136	0.267	91	30
</code></pre><p>如果用传统<code>open()</code>的方法读取文件并打印出来,相对麻烦</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>file <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">r</span><span style="color:#f1fa8c">&#39;/Users/gong/Documents/PKU/Courses/python_basic/python course_2025/常规小时数据.csv&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">with</span> <span style="color:#8be9fd;font-style:italic">open</span>(file,<span style="color:#f1fa8c">&#39;r&#39;</span>,encoding<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;utf-8&#39;</span>) <span style="color:#ff79c6">as</span> fread:
</span></span><span style="display:flex;"><span>header <span style="color:#ff79c6">=</span> fread<span style="color:#ff79c6">.</span>readline()
</span></span><span style="display:flex;"><span>header <span style="color:#ff79c6">=</span> header<span style="color:#ff79c6">.</span>strip()
</span></span><span style="display:flex;"><span>header_list <span style="color:#ff79c6">=</span> header<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39;,&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">for</span> row <span style="color:#ff79c6">in</span> fread:
</span></span><span style="display:flex;"><span>    row <span style="color:#ff79c6">=</span> row<span style="color:#ff79c6">.</span>strip()
</span></span><span style="display:flex;"><span>    row_list <span style="color:#ff79c6">=</span> row<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39;,&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">print</span>(row_list)
</span></span></code></pre></div><p>同样的文件，采用pandas读取，仅需要简单两行命令就行。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> pandas <span style="color:#ff79c6">as</span> pd <span style="color:#6272a4">#导入pandas库</span>
</span></span><span style="display:flex;"><span>df <span style="color:#ff79c6">=</span> pd<span style="color:#ff79c6">.</span>read_csv(file) <span style="color:#6272a4">#读取文件,pd.read_csv是读取csv格式文件的一个命令</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(df)
</span></span></code></pre></div><p>而常见的信息查看、行列筛选，在pandas库中也是非常的简单<br>
<br/>
<strong>查看读取数据的基本情况</strong><br>
pandas读取到数据后，可以用pandas自带的命令查看相关信息，如<code>pd.head()</code>是前面5行,<code>pd.tail()</code>是最后面的5行,<code>pd.shape</code>是看数据的行列数据,<code>pd.dolumns()</code>是看数据的表头，<code>df.describe()</code>查看基本统计信息.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#6272a4"># 查看前几行</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(df<span style="color:#ff79c6">.</span>head())
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 查看后几行</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(df<span style="color:#ff79c6">.</span>tail())
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 查看行列数</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(df<span style="color:#ff79c6">.</span>shape)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 查看列名</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(df<span style="color:#ff79c6">.</span>columns)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 查看基本统计信息</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(df<span style="color:#ff79c6">.</span>describe())
</span></span></code></pre></div><p><code>pd.describe()</code>是pandas数据处理中非常重要的一个命令，它能够查看数据的基本统计信息，如下所示</p>
<pre tabindex="0"><code>            NO2         NOx          O3   CO(mg/m3)        PM10       PM2.5
count  569.000000  569.000000  571.000000  572.000000  567.000000  550.000000
mean    24.200351   28.068541   92.350263    0.653462  151.576720   48.010909
std     13.173888   17.636506   41.937421    0.454901  137.185724   32.062324
min      6.000000    8.000000    1.000000    0.095000   31.000000   14.000000
25%     14.000000   16.000000   62.000000    0.389750   69.000000   30.000000
50%     20.000000   22.000000   92.000000    0.562000  105.000000   39.000000
75%     31.000000   35.000000  121.000000    0.782000  184.500000   54.000000
max     73.000000  121.000000  195.000000    4.322000  920.000000  223.000000
</code></pre><p>它输出了表格的数据量、平均值、标准差、最小时、最大值等统计信息，这里需要注意，如果是字符串的统计数据，则不会体现数据的统计状态，而是不同字符串出现的次数。</p>
 <br/>
</li>
<li>
<p><strong>表格筛选</strong><br>
对与标准表格来讲，<code>pd.describe()</code>和<code>print()</code>可以支持我们查看数据状态，当然除了数据状态外，我们需要对表格内容进行简单的操作，如筛选指定的行或者列。
对于筛选列，pandas提供了列名进行操作，就像excel标选中对应列一样。<br>
<br/>
<strong>(1)列筛选</strong><br>
首先介绍列的操作，如下程序所示：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>columns <span style="color:#ff79c6">=</span> df<span style="color:#ff79c6">.</span>columns() <span style="color:#6272a4">#查看有哪些列</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#筛选单列</span>
</span></span><span style="display:flex;"><span>col_SO2 <span style="color:#ff79c6">=</span> data[<span style="color:#f1fa8c">&#39;SO2&#39;</span>] <span style="color:#6272a4">#筛选SO2列,返回单列的序列</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(col_SO2) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#筛选多列</span>
</span></span><span style="display:flex;"><span>col_multi <span style="color:#ff79c6">=</span> data[[<span style="color:#f1fa8c">&#39;时间&#39;</span>,<span style="color:#f1fa8c">&#39;SO2&#39;</span>,<span style="color:#f1fa8c">&#39;NO2&#39;</span>]] <span style="color:#6272a4">#中括号中放入需要查找列的list</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(col_multi)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#修改列名 </span>
</span></span><span style="display:flex;"><span>data<span style="color:#ff79c6">.</span>rename(columns<span style="color:#ff79c6">=</span>{<span style="color:#f1fa8c">&#39;PM2.5&#39;</span>:<span style="color:#f1fa8c">&#39;PM25&#39;</span>}, inplace<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>)
</span></span></code></pre></div> <br/>
<p><strong>(2)行筛选</strong><br>
接着我们来看关于行的操作,行的操作我们主要用到index(索引),dataframe自带每一行的一个索引，与excel行号类似。看下面代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>line1 <span style="color:#ff79c6">=</span> data<span style="color:#ff79c6">.</span>loc[<span style="color:#bd93f9">0</span>] <span style="color:#6272a4">#筛选1行，给定对应的行索引</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(line1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>line0_6 <span style="color:#ff79c6">=</span> data<span style="color:#ff79c6">.</span>loc[<span style="color:#bd93f9">0</span>:<span style="color:#bd93f9">6</span>] <span style="color:#6272a4">#筛选多行，用`:`进行切片，如同字符串一样</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(line0_6)
</span></span></code></pre></div><p>那如果我们不知道对应的行呢，需要筛选才能找到呢，比如PM2.5 &gt; 75的行，可以用判断筛选，如下所示：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>ds <span style="color:#ff79c6">=</span> data[data[<span style="color:#f1fa8c">&#39;PM25&#39;</span>]<span style="color:#ff79c6">&gt;</span><span style="color:#bd93f9">75</span>] <span style="color:#6272a4">#筛选PM25大于75的行，其它类似</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(ds)
</span></span></code></pre></div> <br/>
<p><strong>(3)行列一并筛选</strong></p>
<p>前面介绍了关于行列的简单筛选，但仅筛选了其中的一部分，而实际应用中，我们会用到行和列的组合筛选，python提供了<code>pd.loc</code>和<code>pd.iloc</code>两种方式，其中<code>pd.iloc</code>
只能使用整数位置索引（数字），不能使用列名（字符串）<br>
我们举例来看，筛选NO2、SO2、O3三列的前10行内容，我们用 <code>loc</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>ds <span style="color:#ff79c6">=</span> data<span style="color:#ff79c6">.</span>loc[data<span style="color:#ff79c6">.</span>index[<span style="color:#bd93f9">0</span>:<span style="color:#bd93f9">10</span>], [<span style="color:#f1fa8c">&#39;NO2&#39;</span>,<span style="color:#f1fa8c">&#39;O3&#39;</span>,<span style="color:#f1fa8c">&#39;SO2&#39;</span>]]  <span style="color:#6272a4"># 同时选行和列，前面是行的索引切片，后面是列的列表</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(ds)
</span></span></code></pre></div><p>筛选2-5列的前面10行数据，我们用 <code>iloc</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>ds <span style="color:#ff79c6">=</span> data<span style="color:#ff79c6">.</span>loc[:<span style="color:#bd93f9">100</span>,<span style="color:#bd93f9">2</span>:<span style="color:#bd93f9">6</span>]  <span style="color:#6272a4"># 同时选行和列，前面的冒号是行的切片，后面的冒号是行的切片</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(ds)
</span></span></code></pre></div><p>如果是需要同时满足多个条件的列筛选，则需要加括号<code>df[()&amp;()]</code>,看示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>ds <span style="color:#ff79c6">=</span> data[(data[<span style="color:#f1fa8c">&#39;PM2.5&#39;</span>] <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">60</span>) <span style="color:#ff79c6">&amp;</span> (data[<span style="color:#f1fa8c">&#39;O3&#39;</span>] <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">100</span>)] <span style="color:#6272a4">#筛选PM25大于60的行，臭氧大于100的行</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(ds)
</span></span></code></pre></div> <br/>
<p><strong>(4)多条件筛选</strong><br>
上面两种方式是对已知的内容进行筛选，当我们不确定内容，或者内容很多时怎么办呢，而在实际数据处理中，我们常常需要找到某列中等于、包含或匹配某个值的行，这个时候我们需要精确或者模糊的查找。
<br/>
首先介绍使用布尔索引进行查找，看列子：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>单个值查找
</span></span><span style="display:flex;"><span>ds <span style="color:#ff79c6">=</span> data[data[<span style="color:#f1fa8c">&#39;站点名称&#39;</span>] <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;站点A&#39;</span>] <span style="color:#6272a4"># 查找站点为“站点A”的行</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#也可以同时匹配多个值</span>
</span></span><span style="display:flex;"><span>ds <span style="color:#ff79c6">=</span> data[data[<span style="color:#f1fa8c">&#39;站点名称&#39;</span>]<span style="color:#ff79c6">.</span>isin([<span style="color:#f1fa8c">&#39;站点A&#39;</span>, <span style="color:#f1fa8c">&#39;站点B&#39;</span>])] <span style="color:#6272a4"># 查找站点为“站点A”或“站点B”的行</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(ds)
</span></span></code></pre></div> <br/>
<p>在观测或实验数据中，<code>-999、-99、-9999</code> 等常被用来表示缺测或无效数据。为了在分析前清洗数据，我们需要找出所有包含这些值的行。
首先是查找某列中等于 <code>-999</code> 的行</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>ds <span style="color:#ff79c6">=</span> data[data[<span style="color:#f1fa8c">&#39;PM25&#39;</span>] <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">999</span>]
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(ds)
</span></span></code></pre></div> <br/>
<p>但是如果你想找出任意列中含有 <code>-999</code> 的行,需要用更高级一些的用法<code>mask</code>,先标记出所有含<code>-999</code>的行，然后输出</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>mask <span style="color:#ff79c6">=</span> (data <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">999</span>)<span style="color:#ff79c6">.</span>any(axis<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>)<span style="color:#6272a4"># 返回任意一列含不含 -999 的行索引</span>
</span></span><span style="display:flex;"><span>df_with_neg999 <span style="color:#ff79c6">=</span> data[mask]
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(df_with_neg999)
</span></span></code></pre></div> <br/>
<p>如果数据表中，有多个缺省值<code>-99、-999、-9999</code>，则可以用<code>target</code>来实现</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PYTHON" data-lang="PYTHON"><span style="display:flex;"><span>targets <span style="color:#ff79c6">=</span> [<span style="color:#ff79c6">-</span><span style="color:#bd93f9">999</span>, <span style="color:#ff79c6">-</span><span style="color:#bd93f9">9999</span>]
</span></span><span style="display:flex;"><span>mask <span style="color:#ff79c6">=</span> data<span style="color:#ff79c6">.</span>isin(targets)<span style="color:#ff79c6">.</span>any(axis<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>)
</span></span><span style="display:flex;"><span>df_invalid <span style="color:#ff79c6">=</span> data[mask]
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(df_invalid)
</span></span></code></pre></div> <br/>
<p>当你想找出某列中包含特定关键词的行，如文本型标记（如 &lsquo;N/A&rsquo;、&lsquo;NaN&rsquo;、&lsquo;NA&rsquo;、&rsquo;null&rsquo; 等，可以用 <code>str.contains()</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#6272a4"># 查找站点名称名中包含“A”的行</span>
</span></span><span style="display:flex;"><span>ds <span style="color:#ff79c6">=</span> data[data[<span style="color:#f1fa8c">&#39;站点名称&#39;</span>]<span style="color:#ff79c6">.</span>str<span style="color:#ff79c6">.</span>contains(<span style="color:#f1fa8c">&#39;A&#39;</span>, na<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>)]<span style="color:#6272a4">#na=False 用于忽略缺失值（NaN），防止报错。</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#更进一步的，采用正则表达式模糊搜索，比如以X结尾的站点</span>
</span></span><span style="display:flex;"><span>ds <span style="color:#ff79c6">=</span> data[data[<span style="color:#f1fa8c">&#39;站点名称&#39;</span>]<span style="color:#ff79c6">.</span>str<span style="color:#ff79c6">.</span>contains(<span style="color:#f1fa8c">&#39;X$&#39;</span>, regex<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>, na<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>)] <span style="color:#6272a4">#查找以“X”结尾的站点</span>
</span></span><span style="display:flex;"><span>ds <span style="color:#ff79c6">=</span> data[data[<span style="color:#f1fa8c">&#39;站点名称&#39;</span>]<span style="color:#ff79c6">.</span>str<span style="color:#ff79c6">.</span>contains(<span style="color:#f1fa8c">&#39;^站点&#39;</span>, regex<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>, na<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>)] <span style="color:#6272a4">#查找以“站点”开头的站点</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(ds)
</span></span></code></pre></div> <br/>
<p>既然有查找值，就有查找空值，空值（Missing Value） 或 NaN（Not a Number） 用来表示缺失或无效的数据，例如：传感器故障、采样丢失、观测中断等都会导致空值出现等等。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PYTHON" data-lang="PYTHON"><span style="display:flex;"><span><span style="color:#6272a4"># 判断每个单元格是否为空</span>
</span></span><span style="display:flex;"><span>data<span style="color:#ff79c6">.</span>isna()
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 判断是否非空</span>
</span></span><span style="display:flex;"><span>data<span style="color:#ff79c6">.</span>notna()
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 查找含有空值的行</span>
</span></span><span style="display:flex;"><span>data[data<span style="color:#ff79c6">.</span>isna()<span style="color:#ff79c6">.</span>any(axis<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>)]
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 查找含有空值的列</span>
</span></span><span style="display:flex;"><span>data<span style="color:#ff79c6">.</span>columns[data<span style="color:#ff79c6">.</span>isna()<span style="color:#ff79c6">.</span>any(axis<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>)]
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 查找 PM2.5 列中为空的行</span>
</span></span><span style="display:flex;"><span>data[data[<span style="color:#f1fa8c">&#39;PM2.5&#39;</span>]<span style="color:#ff79c6">.</span>isna()]
</span></span></code></pre></div> <br/>
<p>找到空值的行列，我们常见操作是进行删除或者用平均值替换</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#6272a4"># 删除含空值的行</span>
</span></span><span style="display:flex;"><span>ds_clean <span style="color:#ff79c6">=</span> data<span style="color:#ff79c6">.</span>dropna()
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 删除含空值的列</span>
</span></span><span style="display:flex;"><span>ds_clean <span style="color:#ff79c6">=</span> data<span style="color:#ff79c6">.</span>dropna(axis<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 填充空值（用0或平均值）</span>
</span></span><span style="display:flex;"><span>ds_filled <span style="color:#ff79c6">=</span> data<span style="color:#ff79c6">.</span>fillna(<span style="color:#bd93f9">0</span>)
</span></span><span style="display:flex;"><span>data[<span style="color:#f1fa8c">&#39;PM25&#39;</span>] <span style="color:#ff79c6">=</span> data[<span style="color:#f1fa8c">&#39;PM25&#39;</span>]<span style="color:#ff79c6">.</span>fillna(data[<span style="color:#f1fa8c">&#39;PM25&#39;</span>]<span style="color:#ff79c6">.</span>mean())
</span></span></code></pre></div></li>
<li>
<p><strong>新增或删除行</strong></p>
<p>在完成文件读取与筛选后，下一步最常见的操作就是新增列、删除列、插入行，在 <code>Pandas</code> 中，<code>DataFrame</code> 类似于一个带标签的 Excel 表格，我们可以灵活地添加、修改或删除行列，构建适合分析的数据结构。
<br/>
<strong>新增列</strong><br>
常见的新增列是基于运算新增，如<code>NO2+O3</code>，<code>PM2.5/PM10</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#6272a4">#创建 PM2.5/PM10 比例列，NO2+O3的列</span>
</span></span><span style="display:flex;"><span>data[<span style="color:#f1fa8c">&#39;PM25_PM10_ratio&#39;</span>] <span style="color:#ff79c6">=</span> data[<span style="color:#f1fa8c">&#39;PM25&#39;</span>]<span style="color:#ff79c6">/</span>data[<span style="color:#f1fa8c">&#39;PM10&#39;</span>]
</span></span><span style="display:flex;"><span>data[<span style="color:#f1fa8c">&#39;Ox&#39;</span>] <span style="color:#ff79c6">=</span> data[<span style="color:#f1fa8c">&#39;NO2&#39;</span>]<span style="color:#ff79c6">+</span>data[<span style="color:#f1fa8c">&#39;O3&#39;</span>]
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(data)
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#当然也有高级的判断新增列</span>
</span></span><span style="display:flex;"><span>data[<span style="color:#f1fa8c">&#39;PM2.5等级&#39;</span>] <span style="color:#ff79c6">=</span> [<span style="color:#f1fa8c">&#39;优&#39;</span> <span style="color:#ff79c6">if</span> x <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">75</span> <span style="color:#ff79c6">else</span> <span style="color:#f1fa8c">&#39;良&#39;</span> <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span> data[<span style="color:#f1fa8c">&#39;PM25&#39;</span>]]
</span></span></code></pre></div> <br/>
<p><strong>删除列或列</strong><br>
删除列较为简单，使用<code>drop</code>命令即可</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PYTHON" data-lang="PYTHON"><span style="display:flex;"><span><span style="color:#6272a4"># 删除单列</span>
</span></span><span style="display:flex;"><span>data<span style="color:#ff79c6">.</span>drop(columns<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;O3&#39;</span>, inplace<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 删除多列</span>
</span></span><span style="display:flex;"><span>data<span style="color:#ff79c6">.</span>drop(columns<span style="color:#ff79c6">=</span>[<span style="color:#f1fa8c">&#39;NO2&#39;</span>, <span style="color:#f1fa8c">&#39;SO2&#39;</span>], inplace<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>) 
</span></span></code></pre></div><p>这里<code>inplace=True</code> 表示在原 <code>DataFrame</code> 上直接修改,若不想影响原数据，可省略此参数
<br/>
删除行也是使用<code>drop</code>命令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PYTHON" data-lang="PYTHON"><span style="display:flex;"><span><span style="color:#6272a4"># 删除索引为 2 的行</span>
</span></span><span style="display:flex;"><span>ds <span style="color:#ff79c6">=</span> data<span style="color:#ff79c6">.</span>drop(index<span style="color:#ff79c6">=</span><span style="color:#bd93f9">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 删除多行</span>
</span></span><span style="display:flex;"><span>ds <span style="color:#ff79c6">=</span> data<span style="color:#ff79c6">.</span>drop(index<span style="color:#ff79c6">=</span>[<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">3</span>])
</span></span></code></pre></div> <br/>
<p><strong>插入行</strong><br>
使用 loc 或 iloc 添加新行，插入行相对麻烦，需要构建新的行，然后进行插入，这与拼接部分比较接近，我们后续在pandas的深入使用中讲解</p>
<p><strong>小练习</strong></p>
<blockquote>
</blockquote>
<p>1.use pd.read_table()读取气象数据</p>
<p>2.find out all the NaN, and replace -9999, 涉及命令replace</p>
<p>3.cal all columns average 涉及命令pd.mean()</p>
<blockquote>
</blockquote>
<h2 id="下载练习">下载练习</h2>
<p>如果你需要一个练习，可以尝试下载后执行练习，<a href="/downloads/4_pandas_deal_with_file.zip">pandas_deal_with_file.ipynb</a>。</p>
</li>
</ol>


                

                
                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/2025-10-06-nt-pycs-file-handling/" data-toggle="tooltip" data-placement="top" title="python学习｜文件处理">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                </ul>
                

                
<script src="https://giscus.app/client.js"
        data-repo="pianist1900/pianist1900.github.io"
        data-repo-id="R_kgDOPmSUaw"
        data-category="General"
        data-category-id="DIC_kwDOPmSUa84CvTsQ"
        data-mapping="pathname"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="light"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script>





            </div>

            
            
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
            

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                

                
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                    <li>
                        <a href="mailto:2506790078@pku.edu.cn">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		           
                    
                    
                    
                    

		            
                    
                    <li>
                        <a target="_blank" href="/img/wechat-friend-invate.png">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-weixin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
            
            
            
           
             </ul>
		<p class="copyright text-muted">
                    Copyright &copy; 龚说龚有理 2025
                    
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function loadAsync(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        loadAsync("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






<script type="text/javascript">
    function generateCatalog(selector) {

        
        
        
        
            _containerSelector = 'div.post-container'
        

        
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        
        $(selector).html('')

        
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow" title="' + t + '">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    


    loadAsync("\/js\/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>






</body>
</html>
